<!DOCTYPE html>
<html>
    <head>
        <title>Cadastro Voos</title>
        <meta charset="utf-8">
        <link rel="stylesheet" type="text/css" href="style/style.css">
        <script lang="javascript">
        // FUNÇÃO PARA REALIZAR A REQUISIÇÃO GET EXIBIR A TABELA DE AERONAVES
        function RequisiçãoGETlistar(){
            const requestOptions = {
                method: 'GET',
                headers: { 'Content-Type': 'application/json' },
              };
              return fetch('http://localhost:3000/listarDados', requestOptions)
              .then(T => T.json())
            }

        // FUNÇÃO PARA EXIBIR AS TABELAS
        function exibirTabela(){
              console.log('Entrou no exibir...')
              RequisiçãoGETlistar()                
              .then(customResponse => {
                    if(customResponse.status === "SUCCESS"){
                      console.log("Deu certo a busca de dados");
                      console.log('Payload:' + JSON.stringify(customResponse.payload));
                      preencherTabela(JSON.parse(JSON.stringify(customResponse.payload)))
                    }else{
                      console.log(customResponse.message);
                    }
                  })
                  .catch((e)=>{
                    console.log("Não foi possível exibir." + e);
                  });
            }
        
            // FUNÇÃO PARA PREENCHER A TABELA DE DADOS, PAGINA ESTATICA INICIAL 
            function preencherTabela(dados) {
              const tblBody = document.getElementById("dados-voos"); //dados voos??
              let voos = "";
              for (let i = 0; i < voos.length; i++) {
                  voo = voos[i];
                  console.log("Dados do voo: " + voo);
                  const row = document.createElement("tr");
                  if (i % 2 === 0)
                    row.className = "evenRow";
                  else
                    row.className = "oddRow";

                  row.innerHTML = 
                    `<td class="leftText">${dados.Código}</td>
                      <td class="leftText">${dados.Data}</td>
                      <td class="leftText">${dados.Trecho}</td>
                      <td class="centerText">${dados.HorarioPartida}</td>
                      <td class="rightText">${dados.Origem}</td>
                      <td class="rightText">${dados.Destino}</td>
                      <td class="centerText">
                        <img
                            src="img src="imagens/editar.png" class="icon_editar"
                            onclick="excluirAeronave(${dados.codigo});" //AQUI, AO CLICAR PARA DELETAR, CHAMARA A FUNÇÃO excluirDados()
                        />
                      </td>`
                  tblBody.appendChild(row);
                }
            }

            // FUNÇÃO PARA REALIZAR A REQUISIÇÃO DELETE 
            function requestExcluirDado(body) {
              const requestOptions = {
                method: 'DELETE',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(body)
              };
              return fetch('http://localhost:3000/excluirDados', requestOptions)
              .then(T => T.json())
            }

            // FUNÇÃO QUE EXCLUI UMA LINHA DE DADOS DA TABELA
            function excluirDados(c){
              console.log('Clicou no excluir aeronave: ' + c);
              requestExcluirDado({codigo: c})
              .then(customResponse => {
                if(customResponse.status === "SUCCESS"){
                  location.reload();
                }else{
                  console.log(customResponse.message);
                }
              })
              .catch((e) => {
                console.log("Não foi possível excluir." + e);
              });
            }

        </script>
    </head>
    <body>
        <h1>Voos Cadastrados</h1>
        <div id="principal">
            <div id="home">
                <div id="botao">
                    <a href="adicionar.html"><button class="adicionar">Add Voo</button></a>
                </div>
                <div id="cadastros">
                    <table cellpadding="5" cellspacing="5">
                        <thead>
                            <tr>
                                <th>Código</th>
                                <th>Data</th>
                                <th>Trecho</th>
                                <th>Horário Partida</th> CRIAR UM APELIDO?????
                                <th>Horário Chegada</th> CRIAR UM APELIDO?????
                                <th>Aeroporto Origem</th> ORIGEM APELIDO JA CRIADOS
                                <th>Aeroporto Destino</th> DESTINO APELIDO JA CRIADO
                            </tr>
                        </thead>
                        <tbody>
                            <!-- <tr>
                                <td>1234</td>
                                <td>12/09/2024</td>
                                <td>Campinas - Rio de Janeiro</td>
                                <td>05:00</td>
                                <td>06:30</td>
                                <td>Vira Copos</td>
                                <td>Santos Dumont</td>
                                <td><a href="alterar.html"><img src="imagens/editar.png" class="icon_editar"></a></td>
                                <td><a href=""><img src="imagens/excluir.png" class="icon_deletar"></a></td>
                            </tr>
                            <tr>
                                <td>3456</td>
                                <td>13/09/2024</td>
                                <td>Curitiba - São Paulo</td>
                                <td>04:30</td>
                                <td>08:00</td>
                                <td>Aeroporto de Curitiba</td>
                                <td>Aeroporto Carlos Fernandes</td>
                                <td><a href=""><img src="imagens/editar.png" class="icon_editar"></a></td>
                                <td><a href=""><img src="imagens/excluir.png" class="icon_deletar"></a></td>
                            </tr>
                            <tr>
                                <td>2004</td>
                                <td>23/09/2024</td>
                                <td>Brasília - São Paulo</td>
                                <td>15:30</td>
                                <td>17:30</td>
                                <td>Aeroporto de Brasília</td>
                                <td>Aeroporto de Congonhas</td>
                                <td><a href=""><img src="imagens/editar.png" class="icon_editar"></a></td>
                                <td><a href=""><img src="imagens/excluir.png" class="icon_deletar"></a></td>
                            </tr>
                            <tr>
                                <td>3120</td>
                                <td>08/10/2024</td>
                                <td>Roma - Paris</td>
                                <td>12:00</td>
                                <td>20:00</td>
                                <td>Aeroporto de Pizza</td>
                                <td>Aeroporto Eiffel</td>
                                <td><a href=""><img src="imagens/editar.png" class="icon_editar"></a></td>
                                <td><a href=""><img src="imagens/excluir.png" class="icon_deletar"></a></td>
                            </tr>
                            <tr>
                                <td>5421</td>
                                <td>22/04/2025</td>
                                <td>Paris - Londres</td>
                                <td>07:30</td>
                                <td>09:30</td>
                                <td>Airport de France</td>
                                <td>London Airport</td>
                                <td><a href=""><img src="imagens/editar.png" class="icon_editar"></a></td>
                                <td><a href=""><img src="imagens/excluir.png" class="icon_deletar"></a></td>
                            </tr>
                            <tr>
                                <td>6066</td>
                                <td>30/10/2023</td>
                                <td>São Paulo - Miami</td>
                                <td>23:24</td>
                                <td>7:49</td>
                                <td>Guarulhos</td>
                                <td>Aeroporto Internacional de Miami</td>
                                <td><a href=""><img src="imagens/editar.png" class="icon_editar"></a></td>
                                <td><a href=""><img src="imagens/excluir.png" class="icon_deletar"></a></td>
                            </tr>
                            <tr>
                                <td>2119</td>
                                <td>07/12/2025</td>
                                <td>Milão - Chile</td>
                                <td>02:24</td>
                                <td>22:53</td>
                                <td>Malpensa</td>
                                <td>Arturo Merino Benitez International Airport</td>
                                <td><a href=""><img src="imagens/editar.png" class="icon_editar"></a></td>
                                <td><a href=""><img src="imagens/excluir.png" class="icon_deletar"></a></td>
                            </tr>
                            <tr>
                                <td>7192</td>
                                <td>08/12/2023</td>
                                <td>Campinas - Campo Grande</td>
                                <td>09:32</td>
                                <td>11:22</td>
                                <td>Viracopos</td>
                                <td>Aeroporto Internacional de Campo Grande</td>
                                <td><a href=""><img src="imagens/editar.png" class="icon_editar"></a></td>
                                <td><a href=""><img src="imagens/excluir.png" class="icon_deletar"></a></td>
                            </tr> -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        <script>
            // A TABELA SERA EXIBIDA AUTOMATICAMENTE AO TERMINAR DE CARREGAR A PAGINA HTML
            exibirTabela();
        </script>
    </body>
</html>